{{ define "main" }}
<!-- Custom html/js page for submitting formulas. Rather than use hugo templating, which has to be static, 
 I kind of reverse engineered the formula pages and render a preview using the user's inputs-->

  <article class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8">
    <header class="max-w-prose">
      <h1 class="mt-0 mb-2 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Suggest a Formula
      </h1>
      <p class="text-lg text-neutral-500 dark:text-neutral-400 mb-6">
        Replace the example fields below with your own formula, preview your submission, and then submit!
      </p>
    </header>
    
    <section class="bg-white dark:bg-neutral-800 rounded-md shadow-sm border border-neutral-200 dark:border-neutral-700">
      <div class="p-6">
        <form id="suggestion-form" class="space-y-6 p-20">
          <div class="space-y-2">
            <label 
            for="title" 
            class="block text-lg mb-1 font-medium text-neutral-700 dark:text-neutral-300">
              Title
            </label>
            <input 
              type="text" 
              id="title" 
              name="title" 
              placeholder="Gaussian/Normal Distribution"
              value="Gaussian/Normal Distribution"
              required
              class="w-full px-4 py-2 mb-6 rounded-md dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            >
          </div>

          <div class="space-y-2">
            <label 
            for="description" 
            class="block text-lg mb-1 font-medium text-neutral-700 dark:text-neutral-300">
              Short Description
            </label>
            <input 
              type="text" 
              id="description" 
              name="description" 
              placeholder="The formula for the normal distribution."
              value="The formula for the normal distribution."
              required
              class="w-full px-4 py-2 mb-6 rounded-md dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            >
          </div>

          <div class="space-y-2">
            <label for="tags" class="block text-lg mb-1 font-medium text-neutral-700 dark:text-neutral-300">
              Tags (comma-separated)
            </label>
            <input 
              type="text" 
              id="tags" 
              name="tags" 
              placeholder="math, statistics, probability theory"
              value="math, statistics, probability theory"
              required
              class="w-full px-4 py-2 mb-6 rounded-md dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            >
          </div>

          <div class="space-y-2">
            <label for="latex" class="block text-lg mb-1 font-medium text-neutral-700 dark:text-neutral-300">
              LaTeX for card preview
            </label>
            <textarea 
              id="latex" 
              name="latex" 
              placeholder="f(x) = \frac{1}{\sigma \sqrt{2\pi}} e^{-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^2}"
              required
              rows="2"
              class="w-full px-4 py-2 mb-6 rounded-md dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            >f(x) = \frac{1}{\sigma \sqrt{2\pi}} e^{-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^2}
            </textarea>
          </div>

          <div class="space-y-2">
            <label for="body" class="block text-lg mb-1 font-medium text-neutral-700 dark:text-neutral-300">
              Body Text (Markdown, LaTeX)
            </label>
            <textarea 
              id="body" 
              name="body" 
              required
              rows="8"
              class="w-full px-4 py-2 mb-6 rounded-md dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-600 focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
            >The formula for the normal distribution as a function of the variable x is:
$$ \frac{1}{\sigma \sqrt{2\pi}} e^{-\frac{1}{2}\left(\frac{x-\mu}{\sigma}\right)^2} $$

Where

* \\( \small e\ \\) is Euler's number, 
* \\( \small  \mu\ \\) is the mean of the distribution, and
* \\\( \small  \sigma\ \\) is the standard deviation of the distribution.

## Sources

- [Wikipedia](https://en.wikipedia.org/wiki/Normal_distribution)
- [Britannica](https://www.britannica.com/topic/uniform-distribution-statistics)</textarea>
          </div>

          <button 
            type="submit"
            class="px-6 py-2 text-base font-semibold text-white rounded-md border-neutral-200 dark:bg-neutral-700 focus:bg-primary-100 hover:bg-primary-100 dark:hover:bg-primary-600 dark:focus:bg-primary-900 focus:outline-dotted focus:outline-transparent focus:outline-2"
          >
            Preview
          </button>
        </form>
      </div>
    </section>

    <section id="preview" class="max-w-prose mt-8 hidden">
      <h2 class="mb-6 text-2xl font-bold text-neutral-900 dark:text-neutral">Preview</h2>
      <div id="preview-content" class="bg-white dark:bg-neutral-800 rounded-lg shadow-sm border border-neutral-200 dark:border-neutral-700 p-12">
      </div>
    </section>
  </article>
  <script>
    // Function to render the preview
    function renderPreview() {
      const title = document.getElementById('title').value;
      const body = document.getElementById('body').value;
      const latex = document.getElementById('latex').value;
      const tags = document.getElementById('tags').value.split(',').map(tag => tag.trim());
      const parsedBody = marked.parse(body);

      const tagsHTML = tags
        .map((tag) => {
          return `
            <a
              class="rounded-md border border-neutral-200 px-2 py-[1px] hover:border-black hover:text-primary-700 dark:border-neutral-600 dark:hover:border-primary-600 dark:hover:text-primary-400"
            >
              ${tag}
            </a>
          `;
        })
        .join(' '); // Join the tags with a space

      const previewContent = `
        <article>
          <header class="max-w-prose">
            <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
              ${title}
            </h1>
            <div class="my-2 text-xs text-neutral-500 dark:text-neutral-400">
              ${tagsHTML}
            </div>
            <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden prose">
              ${parsedBody}
            </div>
          </header>
        </article>
      `;

      document.getElementById('preview-content').innerHTML = previewContent;
      document.getElementById('preview').classList.remove('hidden');

      // Render LaTeX
      if (typeof renderMathInElement !== 'undefined') {
        renderMathInElement(document.getElementById('preview-content'), {
          delimiters: [
            { left: '$$', right: '$$', display: true },
            { left: '\\(', right: '\\)', display: false }
          ]
        });
      }
    }

    // Attach the form submission handler
    document.getElementById('suggestion-form').addEventListener('submit', function(event) {
      event.preventDefault();
      renderPreview();
    });

    // Render the preview when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      renderPreview();
    });
  </script>
{{ end }}